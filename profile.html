<!DOCTYPE html>
<html lang="en">

    <head>
        
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Think Space B2S</title>
        <script src="https://www.gstatic.com/firebasejs/3.6.3/firebase.js"></script> 
        <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase-app.js"></script> 
        <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase-auth.js"></script> 
        <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase-storage.js"></script>
        <script src="https://www.gstatic.com/firebasejs/3.6.1/firebase-messaging.js"></script> 
        <script src="http://code.jquery.com/jquery-latest.min.js"></script> 
        <script src="/socket.io/socket.io.js"></script> 
        <script>         // Initialize Firebase 
        var config = {
            apiKey: "AIzaSyA_rWI-uQ5JyTo2QVUJb2ReO3j1B8hAriU",
            authDomain: "b2sthinkspace-dcda8.firebaseapp.com",
            databaseURL: "https://b2sthinkspace-dcda8.firebaseio.com",
            storageBucket: "b2sthinkspace-dcda8.appspot.com",
            messagingSenderId: "526906895408"
        };
        firebase.initializeApp(config);       </script>

        <!-- CSS -->
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400italic,400">
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Droid+Sans">
        <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lobster">
        <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="assets/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="assets/css/animate.css">
        <link rel="stylesheet" href="assets/css/magnific-popup.css">
        <link rel="stylesheet" href="assets/flexslider/flexslider.css">
        <link rel="stylesheet" href="assets/css/form-elements.css">
        <link rel="stylesheet" href="assets/css/style.css">
        <link rel="stylesheet" href="assets/css/media-queries.css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- Favicon and touch icons -->
        <link rel="icon" href="assets/ico/icon.png">
        <link rel="icon1" sizes="144x144" href="assets/ico/icon1.png">
        <link rel="icon2" sizes="114x114" href="assets/ico/icon2.png">
        <link rel="icon3" sizes="72x72" href="assets/ico/icon3.png">
    

    </head>

    <body>

        <!-- Top menu -->
		  <nav class="navbar" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#top-navbar-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="../../Desktop/thinkspace%20copy/index.html">Think Space B2S</a>
                </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="top-navbar-1">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="index.html"><i class="fa fa-home"></i><br>Home</a>
                        </li>
                        <li>
                            <a href="map.html"><i class="fa fa-map-marker"></i><br>Map</a>
                        </li>
                        <li>
                            <a href="contact.html"><i class="fa fa-envelope"></i><br>Contact</a>
                        </li>
                        <li class="active">
                            <a onclick="loginOrProfile()"><i class="fa fa-user"></i><br>Login</a>
                        </li>
                        
                        
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Page Title -->
        <div class="page-title-container">
            <div class="container">
                <div class="row">
                    <div class="col-sm-12 wow fadeIn">
                        <i class="fa fa-user"></i>
                        <h1>Profile </h1>
                  
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-sm-5 contact-address wow fadeInUp">
                <p>
                  Welcome to Think Space B2S !
                </p>

                <div class="col-sm-6 contact-form wow fadeInLeft">



                            <h3 id="name" >Name : </h3>
                    <!--<p id="name"></p>-->
                            <h3 id="surname"> Surname : </h3>



                <script>
                $(document).ready(function() {


                var readURL = function(input) {
                if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                $('.profile-pic').attr('src', e.target.result);
                    var metadata = {
                        contentType: 'image/jpeg'
                    };
                    window.alert(typeof e.target.result);
                }

                reader.readAsDataURL(input.files[0]);
                }
                }


                $(".file-upload").on('change', function(){
                readURL(this);
                });

                $(".upload-button").on('click', function() {
                $(".file-upload").click();
                });
                });
                </script>
            </div>
            </div>
<div style="margin-right: 20px;">
                <div class="btn-group-vertical" style="float:right ;" >
                    <button style=" background-color:  #4c67c0;"type="button" onclick="location.href='register.html'" class="btn">Edit profile</button>

                <button style=" background-color:  #4c67c0;" type="button" onclick="location.href='booking.html'" class="btn">booking</button>


                    <form>
                        Select your booking:
                        <br>
                        <select id="mySelect" size="10">
                            <!--<option id="0"></option>-->
                            <!--<option id="1"></option>-->
                            <!--<option id="2"></option>-->
                            <!--<option id="3"></option>-->
                            <!--<option id="4"></option>-->
                            <!--<option id="5"></option>-->
                            <!--<option id="6"></option>-->
                            <!--<option id="7"></option>-->
                            <!--<option id="8"></option>-->
                            <!--<option id="9"></option>-->
                        </select>
                    </form>
                    <br>

                    <button onclick="myFunction()">Remove selected booking</button>

                    <script>
                        var select1 = document.getElementById('mySelect');
                        console.log("LOL");
                        firebase.auth().onAuthStateChanged(function (user) {
                            firebase.database().ref("users/"+user.uid+"/booking").once('value',function (snap) {
                                for(var date in snap.val()){
                                    var opt=document.createElement('option');
                                    opt.value = date;
                                     opt.innerHTML=date;
                                     console.log(opt.value);
                                    console.log(opt.innerHTML);
                                     select1.appendChild(opt);

                                }
                            })
                        })
                        function myFunction() {
                            var numUserDel=0;
                            var oldNum=0;
                            var x = document.getElementById("mySelect");
                            var opt=x.options[x.selectedIndex];
                            x.remove(x.selectedIndex);
                            firebase.auth().onAuthStateChanged(function (user) {
                                firebase.database().ref("users/"+user.uid+"/booking/"+opt.value).once('value',function (snap) {
                                    numUserDel=snap.val().numUser;
                                    firebase.database().ref("users/"+user.uid+"/booking/"+opt.value).remove();
                                    firebase.database().ref("Room/"+opt.value).once('value',function(snap1){
                                        oldNum=snap1.val().numUser;
                                        console.log(oldNum);
                                        firebase.database().ref("Room/"+opt.value).update({
                                            numUser : oldNum-numUserDel
                                        })
                                    })
                                })
                            })
                        }
                    </script>

                    <button style=" background-color:  #4c67c0;" type="button" onclick="signout()" class="btn">log out</button>

                </div>
            </div>
            </div>


        <div class="contact-us-container">
        	<div class="container">
	            <div class="row">
	                <h3 id="points"> Point : </h3>
                    <p id="score"> </p>
                    <div>
                    <h3> Booking information : </h3>
                        <div id="info"></div>

                    </div>

                    <div class="col-sm-7 contact-form wow fadeInLeft">
	                  
	              
                        <div class="form-group">
                                <label >For staff</label>
                                <input type="text" name="name" placeholder="For staff.." class="contact-name" id="inputcode">
                            </div>
                            <button  id="collectpoint" onclick="collectPoint()"style=" background-color:  #4c67c0;" type="submit" class="btn">submit</button>
	                </div>
	               
	            </div>
	        </div>
        </div>

        <!-- Footer -->
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-sm-4 footer-box wow fadeInUp">
                        <h4>Who we are</h4>
                        <div class="footer-box-text">
                            <p>
                                B2S is a central group company established in 2011.
                                No.1 Thailand lifestyle bookstore offering curated books and lifestyle merchandises for every lifestyle.
                            </p>

                        </div>
                    </div>
                    <div class="col-sm-4 footer-box wow fadeInUp">
                        <h4>Our vision</h4>
                        <div class="footer-box-text">
                            <p>
                                To be the most outstanding inspiration and thoughtful brand in Thailand. To leverage knowledge and creativity in arts and creative segment among thai communities.
                            </p>

                        </div>
                    </div>

                    <div class="col-sm-4 footer-box wow fadeInUp">
                        <h4>Follow us</h4>
                        <div class="footer-box-text footer-box-text-contact">
                            <a href="https://www.facebook.com/thinkspaceb2s"><i class="fa fa-facebook"></i> ThinkSpaceB2S</a>
                        </div>
                    </div>
                </div>

            </div>
        </footer>

        <!-- Javascript -->
        <script >
            var info = $('#info');
            var allInfo="";
            var myList=$('myList');
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    firebase.database().ref("users/"+user.uid+"/booking/").once('value',function(snap){
                        for( var data in snap.val()) {
                            console.log(data);
                            allInfo += "Date(mmddyyyy):  "+data;
                            firebase.database().ref("users/" + user.uid + "/booking/" + data).once('value', function (snap1){

                            allInfo += ",    number of user: "+snap1.val().numUser + "<br>";
                            });
                        }
//                        console.log(info);
                        info.append(allInfo);
                    });
                } else {

                }
            });
            var nname = $('#name');
            var surname = $('#surname');
            var score =$('#score');
            var inputcode=$('#inputcode');
            var collectpoint=$('#collectpoint');
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in.
                    firebase.database().ref("users/"+user.uid).once('value',function(snap){
                        nname.append(snap.val()["name"]);
                        surname.append(snap.val()["surname"]);
                        score.html(snap.val()["point"]);
                    });
                }
            });

            function upload() {
                console.log("uppic");
                var img = $('#profile');
                //firebase.storage().ref("ProfilePic/"+firebase.auth().currentUser.uid+".jpg").put
            }

            function signout(){
                window.alert("Out");
                firebase.auth().signOut();
                window.location.href="login.html";
            }
            function loginOrProfile() {
                firebase.auth().onAuthStateChanged(function(user) {
                    if (user) {
                        // User is signed in.
                        window.location.href="profile.html";
                    } else {
                        // No user is signed in.
                        window.location.href="login.html";
                    }
                });
            }
            var points1;


            function collectPoint() {
                var checking =(inputcode.val()==="staff1234");
                var intpoint=0;
                console.log(inputcode.val());
                if (checking) {

                    firebase.database().ref("users/" + firebase.auth().currentUser.uid + "/point/").once('value', function (snap) {
                        points1 = snap.val();
                        console.log(points1);
                        intpoint=parseInt(points1);
                        firebase.database().ref("users/" + firebase.auth().currentUser.uid).update({
                            point: intpoint+5

                        });
                    }).then(function () {
                        window.location.href="profile.html";
                    });



                }else{console.log("nopint");}
            }
        </script>
        <script src="assets/js/jquery-1.11.1.min.js"></script>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/js/bootstrap-hover-dropdown.min.js"></script>
        <script src="assets/js/jquery.backstretch.min.js"></script>
        <script src="assets/js/wow.min.js"></script>
        <script src="assets/js/retina-1.1.0.min.js"></script>
        <script src="assets/js/jquery.magnific-popup.min.js"></script>
        <script src="assets/flexslider/jquery.flexslider-min.js"></script>
        <script src="assets/js/jflickrfeed.min.js"></script>
        <script src="assets/js/masonry.pkgd.min.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script src="assets/js/jquery.ui.map.min.js"></script>
        <script src="assets/js/scripts.js"></script>
    <script>
        var nname = $('#name');
        var surname = $('#surname');
        var points =$('#points');


        function upload() {
            console.log("uppic");
            var img = $('#profile');
            //firebase.storage().ref("ProfilePic/"+firebase.auth().currentUser.uid+".jpg").put
        }

        function signout(){
            window.alert("Out");
            firebase.auth().signOut();
            window.location.href="login.html";
        }
    </script>

    </body>

</html>